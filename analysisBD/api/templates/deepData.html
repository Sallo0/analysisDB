<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>Поиск через колено</title>
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
</head>
<body>
 <header>
     <h1 class="title">Поиск через колено</h1>
     <img class="img-urfu" src="{% static 'css/urfu.png'%}" alt="лого УрФУ">
     <img class="img-sbis" src="{% static 'css/sbis.png'%}" alt="лого СБИС">
  </header>


  <form class="requestForm">
           <div>
               <div class="db-type input-container">
                   <label class="label db-type-label" for="db-type">База данных</label>
                   <select class="select-db select" id="db-type" required>
                       <option selected value="PostgreSQL">PostgreSQL</option>
                       <option value="OrientDB">OrientDB</option>
                       <option value="Neo4j">Neo4j</option>
                   </select>
                </div>
               <div>
                   <div class="input-container child-container">
                       <label for="child" class="label child-label">ID дочернего объекта</label>
                       <input class="select" id="child" type="text" placeholder="child...">
                   </div>
               </div>
           </div>

           <div>
               <button type="button" value="Отправить" onclick="sendRequest()">Отправить</button>
           </div>

  </form>
 <div class="data"></div>
 <div class="pages"></div>
 <script>
     function sendRequest() {
         let spinner = document.createElement("div")
         spinner.classList.add("spinner");
         spinner.setAttribute("id", "spinner")
         document.querySelector(".requestForm").append(spinner)

         let data = {
             'dbtype': '',
             'mainfilter': {
                 'Child': 0,
             },
         }

         let result = getInputValue(data)

         fetch(`http://46.48.3.74:8000/` + "getdeepdata", {
             method: 'POST',
             headers: {
                 'Content-Type': 'application/json;charset=utf-8'
             },
             body: JSON.stringify(result)
         })
             .then(response => {
                 if (response.ok) {
                     return response.json()
                 }
             })
             .then(data => {

                 console.log(data)

             });
     }

     function getInputValue(data){
            let result = data;
            let selectDB = document.querySelector(".select-db");

            result['dbtype'] = selectDB.options[selectDB.selectedIndex].value;
            result['mainfilter']['Child'] = document.querySelector("#child").value;

            return result
        }
 </script>

</body>
</html>